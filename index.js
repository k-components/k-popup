// Generated by CoffeeScript 1.8.0
(function() {
  var Popup,
    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  module.exports = Popup = (function() {
    function Popup() {
      this.keydown = __bind(this.keydown, this);
      this.hide = __bind(this.hide, this);
      this.show = __bind(this.show, this);
    }

    Popup.prototype.view = __dirname;

    Popup.prototype.name = 'd-popup';

    Popup.prototype.create = function() {
      var elId;
      elId = this.model.get('element');
      if (elId) {
        this.el = document.getElementById(elId);
        return this.el.addEventListener('click', this.show, false);
      }
    };

    Popup.prototype.show = function(e) {
      var rect;
      console.log('show', this.el);
      if (this.el && e) {
        e.preventDefault();
        e.stopPropagation();
        rect = this.el.getBoundingClientRect();
        console.log(rect, rect.bottom, rect.left + (rect.width / 2));
        this.model.set('top', rect.bottom + 10);
        this.model.set('left', (rect.left + (rect.width / 2)) - 125);
        return this.model.set('show', true);
      }
    };

    Popup.prototype.hide = function(e) {
      var h;
      h = (function(_this) {
        return function() {
          _this.model.del('show');
          return _this.model.del('hiding');
        };
      })(this);
      return this.model.set('hiding', true, function() {
        return setTimeout(h, 310);
      });
    };

    Popup.prototype.keydown = function(e) {
      var key;
      key = e.keyCode || e.which;
      if (key === 27) {
        return this.hide();
      }
    };

    return Popup;

  })();

}).call(this);
